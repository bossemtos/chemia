<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Tytuł będzie ustawiany dynamicznie przez JS -->
    <title>UWI - Uniwersalny Wirtualny Indykator</title>
    <link rel="icon" type="image/x-icon" href="logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Titillium+Web:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

    <style>
        :root {
            --bg-color-1: #0f0c29;
            --bg-color-2: #302b63;
            --bg-color-3: #24243e;
            --container-bg: rgba(255, 255, 255, 0.05);
            --container-border: rgba(255, 255, 255, 0.1);
            --primary-glow: #8a2be2;
            --secondary-glow: #00e5ff;
            --accent-glow: #00ff7f;
            --text-color: #e0e0e0;
            --text-dark: #212529;
            --label-color: #bdbdbd;
            --border-color: rgba(143, 148, 251, 0.3);
            --shadow-color-glow: rgba(138, 43, 226, 0.4);
            --success-color: #00ff7f;
            --error-color: #ff5252;
            --warning-color: #ffee58;
            --input-bg: rgba(255, 255, 255, 0.08);
            --input-focus-bg: rgba(255, 255, 255, 0.1);
            --select-option-bg: #ffffff;
            --font-primary: 'Titillium Web', sans-serif;
            --font-display: 'Orbitron', sans-serif;
            --animation-speed-fast: 0.25s;
            --animation-speed-medium: 0.5s;
            --animation-speed-slow: 0.8s;
            --cursor-pointer: pointer;
            --cursor-default: default;
        }

        @keyframes backgroundGradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes fadeInSlideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleInGlow { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes preloaderSpin { to { transform: rotate(360deg); } }

        body { font-family: var(--font-primary); background-color: var(--bg-color-1); background-image: linear-gradient(135deg, var(--bg-color-1) 0%, var(--bg-color-2) 50%, var(--bg-color-3) 100%); background-size: 200% 200%; background-attachment: fixed; animation: backgroundGradientShift 20s ease infinite; margin: 0; padding: 40px; display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; color: var(--text-color); line-height: 1.7; overflow-x: hidden; cursor: var(--cursor-default); }
        #preloader { position: fixed; inset: 0; background-color: var(--bg-color-1); z-index: 9999; display: flex; justify-content: center; align-items: center; opacity: 1; visibility: visible; transition: opacity var(--animation-speed-slow) ease, visibility var(--animation-speed-slow) ease; }
        #preloader .spinner { width: 60px; height: 60px; border: 5px solid rgba(255, 255, 255, 0.2); border-top-color: var(--secondary-glow); border-radius: 50%; animation: preloaderSpin 1s linear infinite; }
        body.loaded #preloader { opacity: 0; visibility: hidden; }

        .container { background: var(--container-bg); backdrop-filter: blur(10px) saturate(180%); padding: 50px 60px; border-radius: 24px; box-shadow: 0 0 30px var(--shadow-color-glow), 0 0 60px rgba(0, 229, 255, 0.1), inset 0 0 0 1px var(--container-border); text-align: center; display: flex; flex-direction: column; align-items: center; width: 95%; max-width: 950px; border: 1px solid var(--container-border); animation: scaleInGlow 1s cubic-bezier(0.165, 0.84, 0.44, 1) 0.5s forwards; opacity: 0; position: relative; }
        
        #language-switcher { position: absolute; top: 20px; right: 25px; display: flex; gap: 10px; z-index: 100; }
        #language-switcher img { width: 28px; height: 28px; cursor: pointer; border-radius: 50%; transition: transform 0.2s ease, box-shadow 0.2s ease; border: 2px solid transparent; }
        #language-switcher img:hover { transform: scale(1.15); }
        #language-switcher img.active { border-color: var(--secondary-glow); box-shadow: 0 0 10px var(--secondary-glow); transform: scale(1.1); }
        
        h1 { font-family: var(--font-display); color: #fff; margin-bottom: 45px; font-weight: 700; font-size: 3em; position: relative; letter-spacing: 2px; text-shadow: 0 0 10px var(--primary-glow), 0 0 20px var(--secondary-glow); }
        h1 i { margin-right: 18px; color: var(--secondary-glow); animation: floatCosmic 4s ease-in-out infinite; display: inline-block; text-shadow: 0 0 15px var(--secondary-glow); }
        h1 > i.fa-prescription-bottle { margin-left: 18px; }
        
        .controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-end; margin-bottom: 45px; gap: 40px; width: 100%; }
        .control-group { display: flex; flex-direction: column; align-items: flex-start; min-width: 280px; flex-grow: 1; transition: transform var(--animation-speed-medium) cubic-bezier(0.25, 0.46, 0.45, 0.94); position: relative; }
        .control-group::after { content: ''; position: absolute; bottom: -8px; left: 0; height: 2px; width: 0; background: linear-gradient(90deg, var(--secondary-glow), var(--primary-glow)); transition: width var(--animation-speed-medium) ease-out; }
        .control-group:hover::after { width: 70%; }

        label { margin-bottom: 12px; color: var(--label-color); font-size: 1em; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; transition: color var(--animation-speed-fast) ease; }
        .control-group:hover label { color: #fff; }

        input[type="text"], input[type="number"], input[type="color"] { padding: 15px 22px; border: 1px solid var(--border-color); border-radius: 12px; width: 100%; font-size: 1.05em; font-family: var(--font-primary); transition: all var(--animation-speed-medium) ease; box-sizing: border-box; background-color: var(--input-bg); color: var(--text-color); box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        input::placeholder { color: rgba(224, 224, 224, 0.5); }
        input:focus { border-color: var(--secondary-glow); box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.2), inset 0 2px 4px rgba(0,0,0,0.3); outline: none; background-color: var(--input-focus-bg); color: #fff; transform: scale(1.02); }

        /* STYLE DLA DROPDOWN */
        .custom-select-container { position: relative; width: 100%; }
        .custom-select { position: relative; }
        .select-selected { background-color: var(--input-bg); color: #fff; padding: 15px 22px; border: 1px solid var(--border-color); border-radius: 12px; cursor: var(--cursor-pointer); transition: all var(--animation-speed-medium) ease; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="%2300e5ff" class="bi bi-caret-down-fill" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg>'); background-repeat: no-repeat; background-position: right 22px center; background-size: 18px 18px; padding-right: 55px; }
        .select-selected.select-arrow-active { border-radius: 12px 12px 0 0; }
        .select-items { position: absolute; background-color: var(--bg-color-3); top: 100%; left: 0; right: 0; z-index: 99; border: 1px solid var(--secondary-glow); border-top: none; border-radius: 0 0 12px 12px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .select-hide { display: none; }
        .options-container { max-height: 200px; overflow-y: auto; }
        .options-container div { color: var(--text-color); padding: 12px 22px; cursor: var(--cursor-pointer); transition: background-color var(--animation-speed-fast) ease; border-top: 1px solid var(--border-color); }
        .options-container div:first-child { border-top: none; }
        .options-container div:hover { background-color: var(--primary-glow); color: #fff; }

        .display-area { display: flex; flex-direction: column; align-items: center; margin-top: 40px; margin-bottom: 50px; width: 100%; background: rgba(0,0,0,0.1); padding: 40px; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3); transition: box-shadow var(--animation-speed-medium) ease; }
        .display-area:hover { box-shadow: inset 0 0 25px rgba(0, 0, 0, 0.4), 0 0 15px var(--shadow-color-glow); }
        .circle-container { width: 170px; height: 170px; margin-bottom: 25px; position: relative; filter: drop-shadow(0 10px 25px rgba(0,0,0,0.2)); transition: transform var(--animation-speed-medium) cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .circle-container:hover { transform: scale(1.08) rotate(5deg); }
        .circle { width: 150px; height: 150px; border-radius: 50%; background-color: rgba(255,255,255,0.1); border: 7px solid var(--border-color); transition: background-color 0.7s cubic-bezier(0.68, -0.6, 0.27, 1.55), border-color 0.7s ease; display: flex; justify-content: center; align-items: center; box-shadow: inset 0 0 30px rgba(0,0,0,0.15); position: relative; z-index: 1; overflow: hidden; }
        .circle::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 0; background: inherit; transition: height 0.7s cubic-bezier(0.68, -0.6, 0.27, 1.55); z-index: -1; filter: brightness(1.1); }
        .circle.colored { border-color: transparent; animation: pulseNeon 2s ease-in-out infinite alternate; }
        .circle.colored::after { height: 100%; }
        
        #info-display { font-weight: 600; font-size: 1.3em; color: var(--text-color); text-align: center; min-height: 60px; margin-top: 10px; }
        #color-name { cursor: help; transition: color var(--animation-speed-fast) ease; }
        #color-name:hover { color: #fff; text-shadow: 0 0 8px var(--secondary-glow); }
        #color-name, #solution-nature { display: block; margin-top: 12px; opacity: 0; transform: translateY(20px); animation: fadeInSlideUp var(--animation-speed-slow) cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
        #color-name { animation-delay: 0.2s; } #solution-nature { animation-delay: 0.3s; }
        #solution-nature span { font-family: var(--font-display); font-weight: 500; font-size: 0.9em; background-color: rgba(143, 148, 251, 0.2); color: var(--secondary-glow); padding: 5px 12px; border-radius: 20px; margin-left: 12px; display: inline-block; transition: all var(--animation-speed-medium) ease; box-shadow: 0 0 5px rgba(143, 148, 251, 0.3); border: 1px solid rgba(143, 148, 251, 0.5); }
        #solution-nature:hover span { background-color: var(--secondary-glow); color: var(--bg-color-1); box-shadow: 0 0 10px var(--secondary-glow); }
        
        #ph-slider-container { width: 80%; max-width: 400px; margin-top: 25px; text-align: center; opacity: 0; transition: opacity var(--animation-speed-medium) ease; pointer-events: none; }
        #ph-slider-container.visible { opacity: 1; pointer-events: auto; animation: fadeIn var(--animation-speed-slow) ease; }
        #ph-slider-container label { font-family: var(--font-display); font-size: 1em; color: var(--label-color); letter-spacing: 1px; }
        #slider-ph-value { font-weight: 700; color: #fff; text-shadow: 0 0 5px var(--secondary-glow); margin-left: 8px; }
        
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: var(--input-bg); border-radius: 10px; cursor: pointer; margin-top: 15px; border: 1px solid var(--border-color); box-shadow: inset 0 1px 3px rgba(0,0,0,0.4); outline: none; transition: box-shadow var(--animation-speed-medium) ease; }
        input[type="range"]:hover { box-shadow: inset 0 1px 3px rgba(0,0,0,0.4), 0 0 8px var(--secondary-glow); }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; background: var(--secondary-glow); border-radius: 50%; border: 3px solid var(--bg-color-3); cursor: pointer; box-shadow: 0 0 10px var(--secondary-glow), 0 0 20px rgba(0, 229, 255, 0.5); transition: all var(--animation-speed-medium) ease; margin-top: -9px; }
        input[type="range"]:active::-webkit-slider-thumb { transform: scale(1.15); box-shadow: 0 0 15px var(--secondary-glow), 0 0 30px rgba(0, 229, 255, 0.7); }
        input[type="range"]::-moz-range-thumb { width: 24px; height: 24px; background: var(--secondary-glow); border-radius: 50%; border: 3px solid var(--bg-color-3); cursor: pointer; box-shadow: 0 0 10px var(--secondary-glow), 0 0 20px rgba(0, 229, 255, 0.5); transition: all var(--animation-speed-medium) ease; }
        input[type="range"]:active::-moz-range-thumb { transform: scale(1.15); box-shadow: 0 0 15px var(--secondary-glow), 0 0 30px rgba(0, 229, 255, 0.7); }
        
        .form-container { margin-top: 50px; padding: 40px 45px; border: none; border-radius: 20px; width: 100%; background: rgba(0,0,0,0.2); box-shadow: 0 10px 35px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); }
        .form-container h2 { font-size: 1.8em; margin-top: 0; margin-bottom: 35px; color: #fff; border-bottom: 4px solid; border-image-slice: 1; border-image-source: linear-gradient(90deg, var(--primary-glow), var(--secondary-glow)); padding-bottom: 15px; text-align: left; font-weight: 700; animation: borderImageAnimation 4s linear infinite alternate; text-shadow: 0 0 8px var(--primary-glow); }
        .form-container h2 i { margin-right: 15px; color: var(--secondary-glow); transition: transform var(--animation-speed-medium) ease; }
        .form-container h2:hover i { transform: rotate(-20deg) scale(1.15); filter: drop-shadow(0 0 5px var(--secondary-glow)); }
        .form-container form { display: flex; flex-direction: column; align-items: stretch; margin-bottom: 25px; position: relative; }
        .indicator-range-group { display: grid; grid-template-columns: 1fr 1fr; grid-template-areas: "phmin phmax" "name name" "color color" "remove remove"; gap: 20px 25px; margin-bottom: 30px; padding: 30px; border: 1px solid var(--border-color); border-radius: 12px; background-color: rgba(255,255,255,0.05); position: relative; transition: all var(--animation-speed-medium) cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow var(--animation-speed-fast) ease; animation: scaleInGlow 0.6s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .indicator-range-group:hover { border-color: var(--secondary-glow); box-shadow: 0 8px 25px rgba(0, 229, 255, 0.15); transform: translateY(-4px); }
        .remove-range-btn-container { grid-area: remove; justify-self: end; margin-top: 10px;}
        .add-range-btn, .remove-range-btn { padding: 12px 20px; font-size: 1em; border: none; border-radius: 10px; cursor: var(--cursor-pointer); transition: all var(--animation-speed-medium) ease; color: white; font-weight: 600; display: inline-flex; align-items: center; gap: 10px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .add-range-btn { background: linear-gradient(45deg, var(--accent-glow), #81c784); margin-top: 20px; box-shadow: 0 4px 10px rgba(86, 171, 47, 0.4); }
        .add-range-btn:hover { background: linear-gradient(45deg, #81c784, var(--accent-glow)); transform: translateY(-4px) scale(1.05); box-shadow: 0 7px 15px rgba(86, 171, 47, 0.5); }
        .remove-range-btn { background-color: rgba(255,255,255, 0.1); color: var(--label-color); padding: 8px 16px; font-size: 0.9em; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid var(--border-color); }
        .remove-range-btn:hover { background-color: var(--error-color); color: white; transform: scale(1.08) rotate(-5deg); box-shadow: 0 4px 10px rgba(229, 82, 82, 0.4); border-color: transparent; }
        .form-container form button[type="submit"] { padding: 16px 40px; background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow)); color: white; border: none; border-radius: 12px; cursor: var(--cursor-pointer); font-size: 1.2em; font-weight: 700; transition: all var(--animation-speed-medium) cubic-bezier(0.175, 0.885, 0.32, 1.275); width: auto; align-self: flex-end; margin-top: 30px; box-shadow: 0 6px 20px var(--shadow-color-glow); display: inline-flex; align-items: center; gap: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .form-container form button[type="submit"]:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 10px 30px var(--shadow-color-glow); background: linear-gradient(45deg, var(--secondary-glow), var(--primary-glow)); }
        
        .message { margin-top: 30px; font-size: 1.1em; font-weight: 600; min-height: 1.6em; padding: 16px 22px; border-radius: 12px; text-align: left; display: flex; align-items: center; gap: 15px; opacity: 0; animation: fadeInSlideUp var(--animation-speed-slow) ease-out forwards; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-width: 2px; border-style: solid; display: none; }
        .message.visible { display: flex; }
        
        #reset-data-container { margin-top: 20px; width: 100%; text-align: right; }
        #reset-data-btn { background-color: rgba(255, 82, 82, 0.2); border: 1px solid var(--error-color); color: var(--error-color); padding: 8px 15px; border-radius: 8px; cursor: pointer; transition: all var(--animation-speed-medium) ease; font-weight: 600; }
        #reset-data-btn:hover { background-color: var(--error-color); color: #fff; box-shadow: 0 0 10px rgba(255, 82, 82, 0.5); }
        
        .copyright { text-align: center; margin-top: 50px; font-size: 0.9em; color: rgba(255, 255, 255, 0.6); padding-bottom: 20px; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); opacity: 0; animation: fadeInSlideUp 1.2s ease-out 1.5s forwards; }
    </style>
    <script>
        // --- START: TRANSLATION DATA ---
        let currentLang = 'pl';

        const translations = {
            pageTitle: {
                pl: 'UWI - Uniwersalny Wirtualny Indykator',
                en: 'UVI - Universal Virtual Indicator',
                fr: 'IVU - Indicateur Virtuel Universel',
                ru: 'УВИ - Универсальный виртуальный индикатор'
            },
            mainHeader: {
                pl: 'Uniwersalny Wirtualny Indykator',
                en: 'Universal Virtual Indicator',
                fr: 'Indicateur Virtuel Universel',
                ru: 'Универсальный виртуальный индикатор'
            },
            indicatorLabel: {
                pl: 'Wskaźnik',
                en: 'Indicator',
                fr: 'Indicateur',
                ru: 'Индикатор'
            },
            solutionLabel: {
                pl: 'Roztwór (Preset pH)',
                en: 'Solution (pH Preset)',
                fr: 'Solution (Préréglage pH)',
                ru: 'Раствор (Пресет pH)'
            },
            selectIndicator: {
                pl: '-- Wybierz wskaźnik --',
                en: '-- Select Indicator --',
                fr: '-- Choisir un Indicateur --',
                ru: '-- Выберите индикатор --'
            },
            selectSolution: {
                pl: '-- Wybierz roztwór --',
                en: '-- Select Solution --',
                fr: '-- Choisir une Solution --',
                ru: '-- Выберите раствор --'
            },
            adjustPhLabel: {
                pl: 'Dostosuj pH:',
                en: 'Adjust pH:',
                fr: 'Ajuster le pH :',
                ru: 'Настроить pH:'
            },
            chooseIndicator: {
                pl: 'Wybierz wskaźnik',
                en: 'Select an indicator',
                fr: 'Sélectionnez un indicateur',
                ru: 'Выберите индикатор'
            },
            colorLabel: {
                pl: 'Kolor:',
                en: 'Color:',
                fr: 'Couleur :',
                ru: 'Цвет:'
            },
            phOutOfRange: {
                pl: 'pH poza zakresem wskaźnika',
                en: 'pH out of indicator range',
                fr: 'pH hors de la plage de l\'indicateur',
                ru: 'pH вне диапазона индикатора'
            },
            reactionLabel: {
                pl: 'Odczyn:',
                en: 'Reaction:',
                fr: 'Réaction :',
                ru: 'Реакция:'
            },
            acidic: {
                pl: 'kwasowy',
                en: 'acidic',
                fr: 'acide',
                ru: 'кислотная'
            },
            neutral: {
                pl: 'obojętny',
                en: 'neutral',
                fr: 'neutre',
                ru: 'нейтральная'
            },
            basic: {
                pl: 'zasadowy',
                en: 'basic',
                fr: 'basique',
                ru: 'щелочная'
            },
            addIndicatorHeader: {
                pl: 'Dodaj Nowy Wskaźnik',
                en: 'Add New Indicator',
                fr: 'Ajouter un Nouvel Indicateur',
                ru: 'Добавить новый индикатор'
            },
            indicatorNameLabel: {
                pl: 'Nazwa Wskaźnika',
                en: 'Indicator Name',
                fr: 'Nom de l\'Indicateur',
                ru: 'Название индикатора'
            },
            indicatorNamePlaceholder: {
                pl: 'Np. Nowy Wskaźnik',
                en: 'E.g. New Indicator',
                fr: 'Ex. Nouvel Indicateur',
                ru: 'Напр. Новый индикатор'
            },
            phRangesLabel: {
                pl: 'Zakresy pH i Kolory',
                en: 'pH Ranges and Colors',
                fr: 'Plages de pH et Couleurs',
                ru: 'Диапазоны pH и цвета'
            },
            addRangeBtn: {
                pl: 'Dodaj Zakres',
                en: 'Add Range',
                fr: 'Ajouter une Plage',
                ru: 'Добавить диапазон'
            },
            addIndicatorBtn: {
                pl: 'Dodaj Wskaźnik',
                en: 'Add Indicator',
                fr: 'Ajouter l\'Indicateur',
                ru: 'Добавить индикатор'
            },
            addSolutionHeader: {
                pl: 'Dodaj Nowy Roztwór',
                en: 'Add New Solution',
                fr: 'Ajouter une Nouvelle Solution',
                ru: 'Добавить новый раствор'
            },
            solutionNameLabel: {
                pl: 'Nazwa Roztworu',
                en: 'Solution Name',
                fr: 'Nom de la Solution',
                ru: 'Название раствора'
            },
            solutionNamePlaceholder: {
                pl: 'Np. Woda z kranu',
                en: 'E.g. Tap water',
                fr: 'Ex. Eau du robinet',
                ru: 'Напр. Водопроводная вода'
            },
            phValueLabel: {
                pl: 'Wartość pH (0-14)',
                en: 'pH Value (0-14)',
                fr: 'Valeur du pH (0-14)',
                ru: 'Значение pH (0-14)'
            },
            phValuePlaceholder: {
                pl: 'Np. 7,2',
                en: 'E.g. 7.2',
                fr: 'Ex. 7,2',
                ru: 'Напр. 7,2'
            },
            addSolutionBtn: {
                pl: 'Dodaj Roztwór',
                en: 'Add Solution',
                fr: 'Ajouter la Solution',
                ru: 'Добавить раствор'
            },
            clearDataBtn: {
                pl: 'Wyczyść moje dane',
                en: 'Clear my data',
                fr: 'Effacer mes données',
                ru: 'Очистить мои данные'
            },
            clearDataTooltip: {
                pl: 'Usuwa wszystkie zapisane lokalnie wskaźniki i roztwory.',
                en: 'Deletes all locally saved indicators and solutions.',
                fr: 'Supprime tous les indicateurs et solutions sauvegardés localement.',
                ru: 'Удаляет все локально сохраненные индикаторы и растворы.'
            },
            copyright: {
                pl: '© Antoni Nowak 2025',
                en: '© Antoni Nowak 2025',
                fr: '© Antoni Nowak 2025',
                ru: '© Антони Новак 2025'
            },
            // Dynamic messages
            indicatorNameEmpty: {
                pl: 'Nazwa wskaźnika nie może być pusta.',
                en: 'Indicator name cannot be empty.',
                fr: 'Le nom de l\'indicateur ne peut pas être vide.',
                ru: 'Название индикатора не может быть пустым.'
            },
            indicatorExists: {
                pl: 'Wskaźnik o tej nazwie już istnieje.',
                en: 'An indicator with this name already exists.',
                fr: 'Un indicateur avec ce nom existe déjà.',
                ru: 'Индикатор с таким названием уже существует.'
            },
            atLeastOneRange: {
                pl: 'Musisz zdefiniować co najmniej jeden zakres pH i kolor.',
                en: 'You must define at least one pH range and color.',
                fr: 'Vous devez définir au moins une plage de pH et une couleur.',
                ru: 'Вы должны определить хотя бы один диапазон pH и цвет.'
            },
            invalidRangeFields: {
                pl: 'Sprawdź, czy wszystkie pola w zakresach są poprawnie wypełnione.',
                en: 'Check if all fields in the ranges are filled correctly.',
                fr: 'Vérifiez si tous les champs dans les plages sont correctement remplis.',
                ru: 'Проверьте, все ли поля в диапазонах заполнены правильно.'
            },
            indicatorAdded: {
                pl: 'Dodano i zapisano wskaźnik: {name}.',
                en: 'Added and saved indicator: {name}.',
                fr: 'Indicateur ajouté et sauvegardé : {name}.',
                ru: 'Индикатор добавлен и сохранен: {name}.'
            },
            solutionFieldsRequired: {
                pl: 'Nazwa i pH roztworu są wymagane.',
                en: 'Solution name and pH are required.',
                fr: 'Le nom et le pH de la solution sont requis.',
                ru: 'Требуется название и pH раствора.'
            },
            invalidPh: {
                pl: 'Wprowadź poprawne pH (liczba od 0 do 14).',
                en: 'Enter a valid pH (number from 0 to 14).',
                fr: 'Entrez un pH valide (nombre de 0 à 14).',
                ru: 'Введите правильный pH (число от 0 до 14).'
            },
            solutionAdded: {
                pl: 'Dodano i zapisano roztwór: {name}.',
                en: 'Added and saved solution: {name}.',
                fr: 'Solution ajoutée et sauvegardée : {name}.',
                ru: 'Раствор добавлен и сохранен: {name}.'
            },
            confirmReset: {
                pl: 'Czy na pewno chcesz usunąć wszystkie swoje zapisane wskaźniki i roztwory? Tej operacji nie można cofnąć.',
                en: 'Are you sure you want to delete all your saved indicators and solutions? This action cannot be undone.',
                fr: 'Êtes-vous sûr de vouloir supprimer tous vos indicateurs et solutions sauvegardés ? Cette action est irréversible.',
                ru: 'Вы уверены, что хотите удалить все сохраненные индикаторы и растворы? Это действие нельзя отменить.'
            },
            hoverColorCode: {
                pl: 'Najedź, aby zobaczyć kod koloru CSS',
                en: 'Hover to see CSS color code',
                fr: 'Survolez pour voir le code couleur CSS',
                ru: 'Наведите, чтобы увидеть код цвета CSS'
            },
            removeRangeBtn: {
                pl: 'Usuń zakres',
                en: 'Remove range',
                fr: 'Supprimer la plage',
                ru: 'Удалить диапазон'
            }
        };
        // --- END: TRANSLATION DATA ---

        // --- START: MULTILINGUAL DATA ---
        const defaultBarwniki = [ { id: 1, nazwa: { pl: 'Fenoloftaleina', en: 'Phenolphthalein', fr: 'Phénolphtaléine', ru: 'Фенолфталеин' } }, { id: 2, nazwa: { pl: 'Oranż metylowy', en: 'Methyl orange', fr: 'Hélianthine', ru: 'Метилоранж' } }, { id: 3, nazwa: { pl: 'Lakmus (papierek)', en: 'Litmus (paper)', fr: 'Tournesol (papier)', ru: 'Лакмус (бумага)' } }, { id: 4, nazwa: { pl: 'Błękit tymolowy', en: 'Thymol blue', fr: 'Bleu de thymol', ru: 'Тимоловый синий' } }, { id: 5, nazwa: { pl: 'Czerwień metylowa', en: 'Methyl red', fr: 'Rouge de méthyle', ru: 'Метиловый красный' } }, { id: 6, nazwa: { pl: 'Błękit bromotymolowy', en: 'Bromothymol blue', fr: 'Bleu de bromothymol', ru: 'Бромтимоловый синий' } }, { id: 7, nazwa: { pl: 'Czerwień fenolowa', en: 'Phenol red', fr: 'Rouge de phénol', ru: 'Феноловый красный' } }, { id: 29, nazwa: { pl: 'Wyciąg z czerwonej kapusty', en: 'Red cabbage extract', fr: 'Extrait de chou rouge', ru: 'Экстракт красной капусты' } }, { id: 35, nazwa: { pl: 'Uniwersalny wskaźnik (roztwór)', en: 'Universal indicator (solution)', fr: 'Indicateur universel (solution)', ru: 'Универсальный индикатор (раствор)' } } /* Skrócona lista dla przykładu */ ];
        const defaultRoztwory = [ { id: 1, nazwa: { pl: 'Kwas solny 1 M', en: 'Hydrochloric acid 1 M', fr: 'Acide chlorhydrique 1 M', ru: 'Соляная кислота 1 М' }, ph: 0.0 }, { id: 8, nazwa: { pl: 'Kwas octowy 0.1 M', en: 'Acetic acid 0.1 M', fr: 'Acide acétique 0.1 M', ru: 'Уксусная кислота 0.1 М' }, ph: 2.9 }, { id: 11, nazwa: { pl: 'Sok cytrynowy', en: 'Lemon juice', fr: 'Jus de citron', ru: 'Лимонный сок' }, ph: 2.4 }, { id: 22, nazwa: { pl: 'Woda destylowana (czysta)', en: 'Distilled water (pure)', fr: 'Eau distillée (pure)', ru: 'Дистиллированная вода (чистая)' }, ph: 7.0 }, { id: 24, nazwa: { pl: 'Krew ludzka', en: 'Human blood', fr: 'Sang humain', ru: 'Кровь человека' }, ph: 7.4 }, { id: 26, nazwa: { pl: 'Roztwór sody oczyszczonej', en: 'Baking soda solution', fr: 'Solution de bicarbonate de soude', ru: 'Раствор пищевой соды' }, ph: 8.3 }, { id: 31, nazwa: { pl: 'Amoniak (roztwór wodny 0.1 M)', en: 'Ammonia (0.1 M aqueous sol.)', fr: 'Ammoniaque (sol. aqueuse 0.1 M)', ru: 'Аммиак (водный раствор 0.1 М)' }, ph: 11.1 }, { id: 36, nazwa: { pl: 'Wodorotlenek sodu 1 M', en: 'Sodium hydroxide 1 M', fr: 'Hydroxyde de sodium 1 M', ru: 'Гидроксид натрия 1 М' }, ph: 14.0 } /* Skrócona lista dla przykładu */ ];
        const defaultKolory = [ { barwnik_id: 1, ph_min: 0.0, ph_max: 8.2, kolor: 'transparent', nazwa_koloru: { pl: 'Bezbarwny', en: 'Colorless', fr: 'Incolore', ru: 'Бесцветный' } }, { barwnik_id: 1, ph_min: 8.2, ph_max: 10.0, kolor: '#FF80AB', nazwa_koloru: { pl: 'Malinowy (różowy)', en: 'Raspberry (pink)', fr: 'Framboise (rose)', ru: 'Малиновый (розовый)' } }, { barwnik_id: 1, ph_min: 10.0, ph_max: 14.0, kolor: '#D81B60', nazwa_koloru: { pl: 'Malinowy (intensywny)', en: 'Raspberry (intense)', fr: 'Framboise (intense)', ru: 'Малиновый (насыщенный)' } }, { barwnik_id: 2, ph_min: 0.0, ph_max: 3.1, kolor: '#d32f2f', nazwa_koloru: { pl: 'Czerwony', en: 'Red', fr: 'Rouge', ru: 'Красный' } }, { barwnik_id: 2, ph_min: 3.1, ph_max: 4.4, kolor: '#ffa000', nazwa_koloru: { pl: 'Pomarańczowy', en: 'Orange', fr: 'Orange', ru: 'Оранжевый' } }, { barwnik_id: 2, ph_min: 4.4, ph_max: 14.0, kolor: '#ffeb3b', nazwa_koloru: { pl: 'Żółty', en: 'Yellow', fr: 'Jaune', ru: 'Желтый' } }, { barwnik_id: 3, ph_min: 0.0, ph_max: 5.0, kolor: '#d32f2f', nazwa_koloru: { pl: 'Czerwony', en: 'Red', fr: 'Rouge', ru: 'Красный' } }, { barwnik_id: 3, ph_min: 5.0, ph_max: 8.0, kolor: '#7b1fa2', nazwa_koloru: { pl: 'Fioletowy', en: 'Violet', fr: 'Violet', ru: 'Фиолетовый' } }, { barwnik_id: 3, ph_min: 8.0, ph_max: 14.0, kolor: '#1976d2', nazwa_koloru: { pl: 'Niebieski', en: 'Blue', fr: 'Bleu', ru: 'Синий' } }, { barwnik_id: 35, ph_min: 0.0, ph_max: 3.0, kolor: '#d32f2f', nazwa_koloru: { pl: 'Czerwony', en: 'Red', fr: 'Rouge', ru: 'Красный' } }, { barwnik_id: 35, ph_min: 3.0, ph_max: 6.0, kolor: '#ffa000', nazwa_koloru: { pl: 'Pomarańczowy/Żółty', en: 'Orange/Yellow', fr: 'Orange/Jaune', ru: 'Оранжевый/Желтый' } }, { barwnik_id: 35, ph_min: 6.0, ph_max: 8.0, kolor: '#689f38', nazwa_koloru: { pl: 'Zielony', en: 'Green', fr: 'Vert', ru: 'Зеленый' } }, { barwnik_id: 35, ph_min: 8.0, ph_max: 11.0, kolor: '#1976d2', nazwa_koloru: { pl: 'Niebieski', en: 'Blue', fr: 'Bleu', ru: 'Синий' } }, { barwnik_id: 35, ph_min: 11.0, ph_max: 14.0, kolor: '#7b1fa2', nazwa_koloru: { pl: 'Fioletowy', en: 'Violet', fr: 'Violet', ru: 'Фиолетовый' } } /* Skrócona lista dla przykładu */ ];
        // --- END: MULTILINGUAL DATA ---

        let barwniki = []; let roztwory = []; let kolory = [];

        function setLanguage(lang) {
            if (!translations.pageTitle[lang]) return; // Fallback if lang doesn't exist
            currentLang = lang;
            document.documentElement.lang = lang;
            localStorage.setItem('uwi_language', lang);

            // Update static text from translations object
            document.title = translations.pageTitle[lang];
            document.querySelector('h1').innerHTML = `<i class="fas fa-vial"></i>UWI<i class="fas fa-prescription-bottle"></i><br> ${translations.mainHeader[lang]}`;
            document.querySelector('label[for="barwnik-search"]').textContent = translations.indicatorLabel[lang];
            document.querySelector('label[for="roztwor-search"]').textContent = translations.solutionLabel[lang];
            document.querySelector('#barwnik-select .select-selected').textContent = translations.selectIndicator[lang];
            document.querySelector('#roztwor-select .select-selected').textContent = translations.selectSolution[lang];
            document.querySelector('#ph-slider-container label').firstChild.textContent = translations.adjustPhLabel[lang] + ' ';
            document.querySelector('.form-container h2:nth-of-type(1)').innerHTML = `<i class="fas fa-vial"></i> ${translations.addIndicatorHeader[lang]}`;
            document.getElementById('nazwa_barwnika').labels[0].textContent = translations.indicatorNameLabel[lang];
            document.getElementById('nazwa_barwnika').placeholder = translations.indicatorNamePlaceholder[lang];
            document.querySelector('#add-barwnik-form > label').textContent = translations.phRangesLabel[lang];
            document.querySelector('.add-range-btn').innerHTML = `<i class="fas fa-plus-circle"></i> ${translations.addRangeBtn[lang]}`;
            document.querySelector('#add-barwnik-form button[type="submit"]').innerHTML = `<i class="fas fa-plus"></i> ${translations.addIndicatorBtn[lang]}`;
            document.querySelector('.form-container h2:nth-of-type(2)').innerHTML = `<i class="fas fa-prescription-bottle"></i> ${translations.addSolutionHeader[lang]}`;
            document.getElementById('nazwa_roztworu').labels[0].textContent = translations.solutionNameLabel[lang];
            document.getElementById('nazwa_roztworu').placeholder = translations.solutionNamePlaceholder[lang];
            document.getElementById('ph_roztworu').labels[0].textContent = translations.phValueLabel[lang];
            document.getElementById('ph_roztworu').placeholder = translations.phValuePlaceholder[lang];
            document.querySelector('#add-roztwor-form button[type="submit"]').innerHTML = `<i class="fas fa-plus"></i> ${translations.addSolutionBtn[lang]}`;
            document.getElementById('reset-data-btn').innerHTML = `<i class="fas fa-trash-alt"></i> ${translations.clearDataBtn[lang]}`;
            document.getElementById('reset-data-btn').title = translations.clearDataTooltip[lang];
            document.querySelector('.copyright').textContent = translations.copyright[lang];
            document.getElementById('color-name').title = translations.hoverColorCode[lang];


            // Update language switcher active state
            document.querySelectorAll('#language-switcher img').forEach(img => {
                img.classList.toggle('active', img.dataset.lang === lang);
            });

            // Repopulate dynamic content
            populateDropdowns();
            updateDisplay();
        }

        function loadData() {
            barwniki = JSON.parse(JSON.stringify(defaultBarwniki));
            roztwory = JSON.parse(JSON.stringify(defaultRoztwory));
            kolory = JSON.parse(JSON.stringify(defaultKolory));
            const savedRoztwory = localStorage.getItem('uwi_custom_roztwory');
            const savedBarwniki = localStorage.getItem('uwi_custom_barwniki');
            const savedKolory = localStorage.getItem('uwi_custom_kolory');
            if (savedRoztwory) roztwory = roztwory.concat(JSON.parse(savedRoztwory));
            if (savedBarwniki && savedKolory) {
                barwniki = barwniki.concat(JSON.parse(savedBarwniki));
                kolory = kolory.concat(JSON.parse(savedKolory));
            }
        }

        function getNextBarwnikId() { return barwniki.length > 0 ? Math.max(0, ...barwniki.map(b => b.id)) + 1 : 1; }
        function getNextRoztworId() { return roztwory.length > 0 ? Math.max(0, ...roztwory.map(r => r.id)) + 1 : 1; }
        
        function showMessage(elementId, message, isSuccess, isWarning = false) { const messageEl = document.getElementById(elementId); messageEl.classList.add('visible'); const existingIcon = messageEl.querySelector('i'); if (existingIcon) existingIcon.remove(); messageEl.textContent = ''; let iconClass = ''; let className = 'message visible '; if (isWarning) { className += 'warning'; iconClass = 'fas fa-exclamation-triangle'; } else if (isSuccess) { className += 'success'; iconClass = 'fas fa-check-circle'; } else { className += 'error'; iconClass = 'fas fa-times-circle'; } messageEl.className = className; const icon = document.createElement('i'); icon.className = iconClass; messageEl.prepend(icon); messageEl.append(document.createTextNode(" " + message)); messageEl.style.animation = 'none'; void messageEl.offsetHeight; messageEl.style.animation = null; if (!isSuccess && !isWarning) { messageEl.style.animationName = 'shakeError, fadeInSlideUp'; } else { messageEl.style.animationName = 'fadeInSlideUp'; } setTimeout(() => { if (messageEl.textContent.trim().endsWith(message.trim())) { messageEl.style.opacity = '0'; setTimeout(() => { messageEl.className = 'message'; messageEl.style.opacity = ''; }, 500); } }, 5000); }
        
        function updateDisplay() {
            const barwnikSelect = document.querySelector('#barwnik-select .select-selected');
            const barwnikIdValue = barwnikSelect.dataset.value;
            const phSlider = document.getElementById('ph-slider');
            const roztworPhValue = phSlider.value;
            const circle = document.querySelector('.circle');
            const colorNameEl = document.getElementById('color-name');
            const solutionNatureEl = document.getElementById('solution-nature');
            const phSliderContainer = document.getElementById('ph-slider-container');
            const localeSeparator = (currentLang === 'en') ? '.' : ',';
            
            [colorNameEl, solutionNatureEl].forEach(el => { el.style.animation = 'none'; el.offsetHeight; el.style.animation = null; });
            colorNameEl.removeAttribute('data-color-code'); colorNameEl.removeAttribute('data-base-text');
            if (!barwnikIdValue) { phSliderContainer.classList.remove('visible'); circle.style.backgroundColor = 'rgba(255,255,255,0.1)'; circle.style.borderColor = 'var(--border-color)'; circle.classList.remove('colored'); colorNameEl.textContent = translations.chooseIndicator[currentLang]; solutionNatureEl.textContent = ''; return; }
            phSliderContainer.classList.add('visible');
            const barwnikId = parseInt(barwnikIdValue); const roztworPh = parseFloat(roztworPhValue);
            if (isNaN(roztworPh)) { circle.style.backgroundColor = 'rgba(255,255,255,0.1)'; circle.style.borderColor = 'var(--border-color)'; circle.classList.remove('colored'); colorNameEl.textContent = 'Błędna wartość pH'; solutionNatureEl.textContent = ''; return; }
            const colorData = kolory.find(k => k.barwnik_id === barwnikId && roztworPh >= k.ph_min && roztworPh < k.ph_max); let finalColorData = colorData; if (!finalColorData) { const lastRange = kolory.filter(k => k.barwnik_id === barwnikId).sort((a, b) => b.ph_max - a.ph_max)[0]; if (lastRange && roztworPh >= lastRange.ph_min && roztworPh <= lastRange.ph_max) { finalColorData = lastRange; } }
            let odczynKey = roztworPh < 6.99 ? 'acidic' : (roztworPh > 7.01 ? 'basic' : 'neutral');
            let odczyn = translations[odczynKey][currentLang];
            document.getElementById('slider-ph-value').textContent = roztworPh.toFixed(1).replace('.', localeSeparator); 
            solutionNatureEl.innerHTML = `${translations.reactionLabel[currentLang]} ${odczyn} <span>pH ${roztworPh.toFixed(2).replace('.', localeSeparator)}</span>`;
            if (finalColorData) { 
                circle.style.backgroundColor = finalColorData.kolor === 'transparent' ? '#ffffff' : finalColorData.kolor; 
                circle.style.borderColor = 'transparent'; circle.classList.add('colored'); 
                const colorName = typeof finalColorData.nazwa_koloru === 'object' ? finalColorData.nazwa_koloru[currentLang] : finalColorData.nazwa_koloru;
                const baseText = `${translations.colorLabel[currentLang]} ${colorName}`; 
                colorNameEl.textContent = baseText; 
                colorNameEl.dataset.baseText = baseText; colorNameEl.dataset.colorCode = finalColorData.kolor; 
            } else { circle.style.backgroundColor = '#e9ecef'; circle.style.borderColor = 'var(--border-color)'; circle.classList.remove('colored'); colorNameEl.textContent = `${translations.colorLabel[currentLang]} ${translations.phOutOfRange[currentLang]}`; }
            colorNameEl.style.animation = `fadeInSlideUp var(--animation-speed-slow) ease-out 0.1s forwards`; solutionNatureEl.style.animation = `fadeInSlideUp var(--animation-speed-slow) ease-out 0.2s forwards`;
        }

        function setupCustomSelect(containerId, items, placeholder, onSelect) {
            const container = document.getElementById(containerId);
            const selected = container.querySelector('.select-selected');
            const optionsContainer = container.querySelector('.options-container');
            
            selected.textContent = placeholder; // Update placeholder text on language change
            selected.dataset.value = '';

            optionsContainer.innerHTML = '';
            items.forEach(item => {
                const optionDiv = document.createElement('div');
                optionDiv.textContent = item.text;
                optionDiv.dataset.value = item.value;
                optionDiv.addEventListener('click', () => {
                    selected.textContent = item.text;
                    selected.dataset.value = item.value;
                    container.querySelector('.select-items').classList.add('select-hide');
                    onSelect(item.value, item.text);
                });
                optionsContainer.appendChild(optionDiv);
            });
        }
        
        function populateDropdowns() {
            const localeSeparator = (currentLang === 'en') ? '.' : ',';
            
            barwniki.sort((a, b) => {
                const nameA = typeof a.nazwa === 'object' ? a.nazwa[currentLang] : a.nazwa;
                const nameB = typeof b.nazwa === 'object' ? b.nazwa[currentLang] : b.nazwa;
                return nameA.localeCompare(nameB, currentLang);
            });
            roztwory.sort((a, b) => {
                const nameA = typeof a.nazwa === 'object' ? a.nazwa[currentLang] : a.nazwa;
                const nameB = typeof b.nazwa === 'object' ? b.nazwa[currentLang] : b.nazwa;
                return nameA.localeCompare(nameB, currentLang);
            });

            const phSlider = document.getElementById('ph-slider');
            const roztworSelected = document.querySelector('#roztwor-select .select-selected');
            
            const barwnikiItems = barwniki.map(b => ({ 
                text: typeof b.nazwa === 'object' ? b.nazwa[currentLang] : b.nazwa, 
                value: b.id 
            }));
            setupCustomSelect('barwnik-select', barwnikiItems, translations.selectIndicator[currentLang], (value, text) => {
                if (!roztworSelected.dataset.value) phSlider.value = 7.0;
                updateDisplay();
            });

            const roztworyItems = roztwory.map(r => ({ 
                text: `${typeof r.nazwa === 'object' ? r.nazwa[currentLang] : r.nazwa} (pH ${r.ph.toFixed(2).replace('.', localeSeparator)})`, 
                value: r.ph 
            }));
            setupCustomSelect('roztwor-select', roztworyItems, translations.selectSolution[currentLang], (value, text) => {
                phSlider.value = value;
                updateDisplay();
            });
        }
        
        function handleAddBarwnik(event) { event.preventDefault(); const nazwaInput = document.getElementById('nazwa_barwnika'); const nazwa = nazwaInput.value.trim(); const messageElId = 'barwnik-message'; const rangeGroups = document.querySelectorAll('#indicator-ranges-container .indicator-range-group'); if (!nazwa) { showMessage(messageElId, translations.indicatorNameEmpty[currentLang], false); return; } if (barwniki.some(b => (typeof b.nazwa === 'object' ? b.nazwa.pl.toLowerCase() : b.nazwa.toLowerCase()) === nazwa.toLowerCase())) { showMessage(messageElId, translations.indicatorExists[currentLang], false); return; } if (rangeGroups.length === 0) { showMessage(messageElId, translations.atLeastOneRange[currentLang], false); return; } const newId = getNextBarwnikId(); const newIndicatorRanges = []; let validationPassed = true; rangeGroups.forEach((group, index) => { const phMin = parseFloat(group.querySelector('.range-ph-min').value.replace(',', '.')); const phMax = parseFloat(group.querySelector('.range-ph-max').value.replace(',', '.')); const colorName = group.querySelector('.range-color-name').value.trim(); const colorCss = group.querySelector('.range-color-css').value.trim(); if (isNaN(phMin) || isNaN(phMax) || phMin < 0 || phMax > 14 || phMin >= phMax || !colorName || !colorCss) { validationPassed = false; } else { newIndicatorRanges.push({ barwnik_id: newId, ph_min: phMin, ph_max: phMax, kolor: colorCss, nazwa_koloru: colorName }); } }); if (!validationPassed) { showMessage(messageElId, translations.invalidRangeFields[currentLang], false); return; } const newBarwnik = { id: newId, nazwa: nazwa }; barwniki.push(newBarwnik); kolory.push(...newIndicatorRanges); let customBarwniki = JSON.parse(localStorage.getItem('uwi_custom_barwniki')) || []; let customKolory = JSON.parse(localStorage.getItem('uwi_custom_kolory')) || []; customBarwniki.push(newBarwnik); customKolory.push(...newIndicatorRanges); localStorage.setItem('uwi_custom_barwniki', JSON.stringify(customBarwniki)); localStorage.setItem('uwi_custom_kolory', JSON.stringify(customKolory)); populateDropdowns(); const barwnikSelected = document.querySelector('#barwnik-select .select-selected'); barwnikSelected.textContent = newBarwnik.nazwa; barwnikSelected.dataset.value = newBarwnik.id; nazwaInput.value = ''; clearIndicatorFormRanges(); showMessage(messageElId, translations.indicatorAdded[currentLang].replace('{name}', nazwa), true); updateDisplay(); }
        function handleAddRoztwor(event) { event.preventDefault(); const nazwaInput = document.getElementById('nazwa_roztworu'); const phInput = document.getElementById('ph_roztworu'); const messageElId = 'roztwor-message'; const nazwa = nazwaInput.value.trim(); const phValue = phInput.value.trim().replace(',', '.'); if (!nazwa || !phValue) { showMessage(messageElId, translations.solutionFieldsRequired[currentLang], false); return; } const ph = parseFloat(phValue); if (isNaN(ph) || ph < 0 || ph > 14) { showMessage(messageElId, translations.invalidPh[currentLang], false); return; } const newId = getNextRoztworId(); const newRoztwor = { id: newId, nazwa: nazwa, ph: ph }; roztwory.push(newRoztwor); let customRoztwory = JSON.parse(localStorage.getItem('uwi_custom_roztwory')) || []; customRoztwory.push(newRoztwor); localStorage.setItem('uwi_custom_roztwory', JSON.stringify(customRoztwory)); populateDropdowns(); const roztworSelected = document.querySelector('#roztwor-select .select-selected'); const localeSeparator = (currentLang === 'en') ? '.' : ','; roztworSelected.textContent = `${newRoztwor.nazwa} (pH ${newRoztwor.ph.toFixed(2).replace('.', localeSeparator)})`; roztworSelected.dataset.value = newRoztwor.ph; document.getElementById('ph-slider').value = ph; nazwaInput.value = ''; phInput.value = ''; showMessage(messageElId, translations.solutionAdded[currentLang].replace('{name}', nazwa), true); updateDisplay(); }

        function clearIndicatorFormRanges() { 
            document.getElementById('indicator-ranges-container').innerHTML = '';
        }

        window.onload = () => {
            document.body.classList.add('loaded');
            loadData();

            // Setup language switcher
            const savedLang = localStorage.getItem('uwi_language') || 'pl';
            setLanguage(savedLang);

            document.querySelectorAll('#language-switcher img').forEach(img => {
                img.addEventListener('click', function() {
                    setLanguage(this.dataset.lang);
                });
            });


            const phSlider = document.getElementById('ph-slider');
            phSlider.addEventListener('input', () => {
                const roztworSelected = document.querySelector('#roztwor-select .select-selected');
                roztworSelected.textContent = translations.selectSolution[currentLang];
                roztworSelected.dataset.value = '';
                updateDisplay();
            });

            document.querySelectorAll('.custom-select .select-selected').forEach(selected => {
                selected.addEventListener('click', function(e) {
                    e.stopPropagation();
                    closeAllSelect(this);
                    this.nextElementSibling.classList.toggle('select-hide');
                    this.classList.toggle('select-arrow-active');
                });
            });

            document.addEventListener('click', closeAllSelect);
            
            document.getElementById('reset-data-btn').addEventListener('click', () => {
                if (confirm(translations.confirmReset[currentLang])) {
                    localStorage.removeItem('uwi_custom_roztwory');
                    localStorage.removeItem('uwi_custom_barwniki');
                    localStorage.removeItem('uwi_custom_kolory');
                    location.reload();
                }
            });

            document.getElementById('add-barwnik-form').addEventListener('submit', handleAddBarwnik); 
            document.getElementById('add-roztwor-form').addEventListener('submit', handleAddRoztwor);
            
            // initial call to set text correctly based on language
            updateDisplay(); 
        };

        function closeAllSelect(elmnt) {
            let x = document.getElementsByClassName("select-items");
            let y = document.getElementsByClassName("select-selected");
            for (let i = 0; i < y.length; i++) {
                if (elmnt == y[i]) { } else { y[i].classList.remove("select-arrow-active"); }
            }
            for (let i = 0; i < x.length; i++) {
                if (elmnt && elmnt.nextElementSibling == x[i]) { } else { x[i].classList.add("select-hide"); }
            }
        }
    </script>
</head>
<body>
    <div id="preloader"><div class="spinner"></div></div>

    <div class="container">
        <!-- Language Switcher -->
        <div id="language-switcher">
            <img src="https://flagcdn.com/w40/pl.png" data-lang="pl" alt="Polski" title="Polski">
            <img src="https://flagcdn.com/w40/gb.png" data-lang="en" alt="English" title="English">
            <img src="https://flagcdn.com/w40/fr.png" data-lang="fr" alt="Français" title="Français">
            <img src="https://flagcdn.com/w40/ru.png" data-lang="ru" alt="Русский" title="Русский">
        </div>
        
        <h1><i class="fas fa-vial"></i>UWI<i class="fas fa-prescription-bottle"></i><br> Uniwersalny Wirtualny Indykator <br> </h1>

        <div class="controls">
            <div class="control-group">
                <label for="barwnik-search">Wskaźnik</label>
                <div id="barwnik-select" class="custom-select-container">
                    <div class="custom-select">
                        <div class="select-selected" data-value="">-- Wybierz wskaźnik --</div>
                        <div class="select-items select-hide">
                            <div class="options-container"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="control-group">
                <label for="roztwor-search">Roztwór (Preset pH)</label>
                <div id="roztwor-select" class="custom-select-container">
                    <div class="custom-select">
                        <div class="select-selected" data-value="">-- Wybierz roztwór --</div>
                        <div class="select-items select-hide">
                            <div class="options-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="display-area">
            <div class="circle-container">
                <div class="circle"></div>
            </div>
            <div id="ph-slider-container">
                <label for="ph-slider">Dostosuj pH: <span id="slider-ph-value">7,0</span></label>
                <input type="range" id="ph-slider" min="0" max="14" value="7" step="0.1">
            </div>
            <div id="info-display">
                <span id="color-name" title="Najedź, aby zobaczyć kod koloru CSS">Wybierz wskaźnik</span>
                <span id="solution-nature"></span>
            </div>
        </div>

        <div class="form-container">
            <h2><i class="fas fa-vial"></i> Dodaj Nowy Wskaźnik</h2>
            <form id="add-barwnik-form" novalidate>
                 <div class="control-group" style="width: 100%; margin-bottom: 20px;">
                    <label for="nazwa_barwnika">Nazwa Wskaźnika</label>
                    <input type="text" id="nazwa_barwnika" required placeholder="Np. Nowy Wskaźnik">
                </div>
                <label style="font-weight: 600; margin-bottom: 15px; display: block; text-align: left; font-size: 1.1em;">Zakresy pH i Kolory</label>
                <div id="indicator-ranges-container">
                </div>
                 <button type="button" class="add-range-btn"><i class="fas fa-plus-circle"></i> Dodaj Zakres</button>
                <button type="submit"><i class="fas fa-plus"></i> Dodaj Wskaźnik</button>
            </form>
            <div id="barwnik-message" class="message"></div>

            <h2><i class="fas fa-prescription-bottle"></i> Dodaj Nowy Roztwór</h2>
            <form id="add-roztwor-form" novalidate>
                 <div class="control-group" style="width: 100%; margin-bottom: 15px;">
                    <label for="nazwa_roztworu">Nazwa Roztworu</label>
                    <input type="text" id="nazwa_roztworu" required placeholder="Np. Woda z kranu">
                </div>
                 <div class="control-group" style="width: 100%; margin-bottom: 15px;">
                    <label for="ph_roztworu">Wartość pH (0-14)</label>
                    <input type="text" id="ph_roztworu" required placeholder="Np. 7,2">
                </div>
                <button type="submit"><i class="fas fa-plus"></i> Dodaj Roztwór</button>
            </form>
            <div id="roztwor-message" class="message"></div>
            
            <div id="reset-data-container">
                <button id="reset-data-btn" title="Usuwa wszystkie zapisane lokalnie wskaźniki i roztwory."><i class="fas fa-trash-alt"></i> Wyczyść moje dane</button>
            </div>
        </div>
    </div>
    <div class="copyright">© Antoni Nowak 2025</div>
</body>
</html>
